<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="oss.mapper.BusiManageMapper">
	<!-- 作品 -->
	<select id="listWorks" resultMap="worksMap" parameterType="oss.bean.Condition">
		select
		A.Worksid,A.Worksname,A.Userid,A.Worksnum,A.Worksprice,A.Classificationid,A.Worksstatusid,B.Classificationname,B.Classificationpid,c.userName,c.userCredit
		from works a, classification b, users c where
		A.Classificationid=B.Classificationid and A.Userid=C.Userid
		<if test="startDate != null and startDate !=''">
			and worksName like concat(concat('%',#{startDate}),'%')
		</if>
		<if test="endDate != null and endDate !='' ">
			and checkUser.userName like
			concat(concat('%',#{endDate}),'%')
		</if>
		<if test="classPid != 0">
			and dynamicTitle =#{classPid}
		</if>
	</select>

	<resultMap type="oss.bean.Works" id="worksMap">
		<id property="worksId" column="worksId" />
		<result property="usersId" column="usersId" />
		<result property="classificationId" column="classificationId" />
		<result property="worksName" column="worksName" />
		<result property="worksPrice" column="worksPrice" />
		<result property="worksNum" column="worksNum" />
		<result property="worksStatusId" column="worksStatusId" />
		<result property="url" column="url" />
		<association property="checkClass" javaType="oss.bean.Classification">
			<id property="classificationId" column="classificationId" />
			<result property="classificationName" column="classificationName" />
			<result property="classificationPid" column="classificationPid" />
		</association>
		<association property="checkUser" javaType="oss.bean.Users">
			<id property="userID" column="userID" />
			<result property="userName" column="userName" />
			<result property="userCredit" column="userCredit" />
		</association>
	</resultMap>



	<!-- 修改动态 -->
	<update id="updateWorksById" parameterType="oss.bean.Works">
		update Works set
		worksStatusId=#{worksStatusId} where worksId=#{worksId}
	</update>

	<!-- 发布作品 hlq 2018-06-27 20:14 -->
	<insert id="insertWorks" parameterType="oss.bean.Works">
		<selectKey keyProperty="worksId" order="BEFORE" resultType="long">
			select workersSeq.nextVal from dual
		</selectKey>
		insert into works
		(worksId, userId, worksName, classificationId, worksPrice, worksNum, worksStatusId, url, worksContext)
		values (#{worksId}, #{userId}, #{worksName}, #{classificationId}, #{worksPrice}, #{worksNum}, #{worksStatusId}, #{url}, #{worksContext})
	</insert>

	<!-- 修改作品成交量 hlq 2018-06-27 21:37 -->
	<update id="updateWorksNumById" parameterType="oss.bean.Works">
		update Works set
		worksNum=worksNum+1 where worksId=#{worksId}
	</update>
</mapper>
	