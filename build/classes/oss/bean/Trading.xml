<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="oss.mapper.BusiManageMapper">
	<!--交易明细 -->
	<select id="tradingList" resultMap="TradingMap" parameterType="oss.bean.Condition">
		select
		A.Tradingid,a.amount,a.demandId,a.amountType,a.tradingTime,c.demandTitle
		from Trading a ,demands c
		where A.Userid=#{classPid} and a.demandId = c.demandId
		<if
			test="startDate != null and endDate != null and startDate !='' and endDate !=''">
			and tradingTime between #{startDate} and #{endDate}
		</if>
	</select>
	<resultMap type="oss.bean.Trading" id="TradingMap">
		<id property="tradingId" column="tradingId" />
		<result property="userId" column="userId" />
		<result property="amount" column="amount" />
		<result property="demandId" column="demandId" />
		<result property="amountType" column="amountType" />
		<result property="tradingTime" column="tradingTime" />
<!-- 		<association property="checkUsers" javaType="oss.bean.Users"> -->
<!-- 			<id property="userID" column="userID" /> -->
<!-- 			<result property="userAccount" column="userAccount" /> -->
<!-- 			<result property="userName" column="userName" /> -->
<!-- 			<result property="userBalance" column="userBalance" /> -->
<!-- 		</association> -->
		<association property="checkDemands" javaType="oss.bean.Demands">
			<id property="demandID" column="demandID" />
			<result property="demandTitle" column="demandTitle" />
			<result property="demandstatusid" column="demandstatusid" />
			<result property="demandTitle" column="demandTitle" />
		</association>
	</resultMap>
	
	<!-- 新增交易记录  hlq 2018-06-29 14:54-->
	<insert id="AddTrading" parameterType="oss.bean.Trading">
		<selectKey keyProperty="tradingId" order="BEFORE" resultType="long">
			select tradingSeq.nextval from dual
		</selectKey>
		insert into
		trading (tradingId,userId,amount,amountType,tradingTime,userId2)
		values(#{tradingId},#{userId},#{amount},#{amountType},#{tradingTime},#{userId2})
	</insert>
</mapper>


